import { ChannelOptionsMerger } from './channel-manager.js';
import { PresenceEventType } from './events.js';
import { Logger } from './logger.js';
import { InternalRoomOptions } from './room-options.js';
import { Subscription } from './subscription.js';
import * as Ably from 'ably';
/**
 * Type for PresenceData. Any JSON serializable data type.
 */
export type PresenceData = unknown;
/**
 * Type for PresenceEvent
 */
export interface PresenceEvent {
    /**
     * The type of the presence event.
     */
    type: PresenceEventType;
    /**
     * The presence member associated with this event.
     */
    member: PresenceMember;
}
/**
 * Type for PresenceMember
 */
export interface PresenceMember {
    /**
     * The clientId of the presence member.
     */
    clientId: string;
    /**
     * The data associated with the presence member.
     */
    data: PresenceData;
    /**
     * The extras associated with the presence member.
     */
    extras: unknown;
    /**
     * The timestamp of when the last change in state occurred for this presence member.
     */
    updatedAt: number;
}
/**
 * Type for PresenceListener
 * @param event The presence event that was received.
 */
export type PresenceListener = (event: PresenceEvent) => void;
/**
 * This interface is used to interact with presence in a chat room: subscribing to presence events,
 * fetching presence members, or sending presence events (join,update,leave).
 *
 * Get an instance via {@link Room.presence}.
 */
export interface Presence {
    /**
     * Method to get list of the current online users and returns the latest presence messages associated to it.
     * @param {Ably.RealtimePresenceParams} params - Parameters that control how the presence set is retrieved.
     * @throws If the room is not in the `attached` or `attaching` state.
     * @returns {Promise<PresenceMessage[]>} or upon failure, the promise will be rejected with an {@link Ably.ErrorInfo} object which explains the error.
     */
    get(params?: Ably.RealtimePresenceParams): Promise<PresenceMember[]>;
    /**
     * Method to check if user with supplied clientId is online
     * @param {string} clientId - The client ID to check if it is present in the room.
     * @throws If the room is not in the `attached` or `attaching` state.
     * @returns {Promise<{boolean}>} or upon failure, the promise will be rejected with an {@link Ably.ErrorInfo} object which explains the error.
     */
    isUserPresent(clientId: string): Promise<boolean>;
    /**
     * Method to join room presence, will emit an enter event to all subscribers. Repeat calls will trigger more enter events.
     * @param {PresenceData} data - The users data, a JSON serializable object that will be sent to all subscribers.
     * @throws If the room is not in the `attached` or `attaching` state.
     * @returns {Promise<void>} or upon failure, the promise will be rejected with an {@link Ably.ErrorInfo} object which explains the error.
     */
    enter(data?: PresenceData): Promise<void>;
    /**
     * Method to update room presence, will emit an update event to all subscribers. If the user is not present, it will be treated as a join event.
     * @param {PresenceData} data - The users data, a JSON serializable object that will be sent to all subscribers.
     * @throws If the room is not in the `attached` or `attaching` state.
     * @returns {Promise<void>} or upon failure, the promise will be rejected with an {@link Ably.ErrorInfo} object which explains the error.
     */
    update(data?: PresenceData): Promise<void>;
    /**
     * Method to leave room presence, will emit a leave event to all subscribers. If the user is not present, it will be treated as a no-op.
     * @param {PresenceData} data - The users data, a JSON serializable object that will be sent to all subscribers.
     * @throws If the room is not in the `attached` or `attaching` state.
     * @returns {Promise<void>} or upon failure, the promise will be rejected with an {@link Ably.ErrorInfo} object which explains the error.
     */
    leave(data?: PresenceData): Promise<void>;
    /**
     * Subscribe the given listener from the given list of events.
     *
     * Note: This requires presence events to be enabled via the `enableEvents` option in
     * the {@link PresenceOptions} provided to the room. If this is not enabled, an error will be thrown.
     *
     * @param eventOrEvents {'enter' | 'leave' | 'update' | 'present'} single event name or array of events to subscribe to
     * @param listener listener to subscribe
     * @throws An {@link Ably.ErrorInfo} with code 40000 if presence events are not enabled
     */
    subscribe(eventOrEvents: PresenceEventType | PresenceEventType[], listener?: PresenceListener): Subscription;
    /**
     * Subscribe the given listener to all presence events.
     *
     * Note: This requires presence events to be enabled via the `enableEvents` option in
     * the {@link PresenceOptions} provided to the room. If this is not enabled, an error will be thrown.
     *
     * @param listener listener to subscribe
     * @throws An {@link Ably.ErrorInfo} with code 40000 if presence events are not enabled
     */
    subscribe(listener?: PresenceListener): Subscription;
}
/**
 * @inheritDoc
 */
export declare class DefaultPresence implements Presence {
    private readonly _channel;
    private readonly _clientId;
    private readonly _logger;
    private readonly _emitter;
    private readonly _options;
    /**
     * Constructs a new `DefaultPresence` instance.
     * @param channel The Realtime channel instance.
     * @param clientId The client ID, attached to presences messages as an identifier of the sender.
     * A channel can have multiple connections using the same clientId.
     * @param logger An instance of the Logger.
     * @param options The room options.
     */
    constructor(channel: Ably.RealtimeChannel, clientId: string, logger: Logger, options: InternalRoomOptions);
    /**
     * Sets up channel subscriptions for presence.
     */
    private _applyChannelSubscriptions;
    /**
     * @inheritDoc
     */
    get(params?: Ably.RealtimePresenceParams): Promise<PresenceMember[]>;
    /**
     * @inheritDoc
     */
    isUserPresent(clientId: string): Promise<boolean>;
    /**
     * @inheritDoc
     */
    enter(data?: PresenceData): Promise<void>;
    /**
     * @inheritDoc
     */
    update(data?: PresenceData): Promise<void>;
    /**
     * @inheritDoc
     */
    leave(data?: PresenceData): Promise<void>;
    /**
     * @inheritDoc
     */
    subscribe(eventOrEvents: PresenceEventType | PresenceEventType[], listener?: PresenceListener): Subscription;
    /**
     * @inheritDoc
     */
    subscribe(listener?: PresenceListener): Subscription;
    /**
     * Method to handle and emit presence events
     * @param member - PresenceMessage ably-js object
     * @returns void - Emits a transformed event to all subscribers, or upon failure,
     * the promise will be rejected with an {@link ErrorInfo} object which explains the error.
     */
    subscribeToEvents: (member: Ably.PresenceMessage) => void;
    /**
     * Merges the channel options for the room with the ones required for presence.
     *
     * @param roomOptions The room options to merge for.
     * @returns A function that merges the channel options for the room with the ones required for presence.
     */
    static channelOptionMerger(roomOptions: InternalRoomOptions): ChannelOptionsMerger;
    private _assertChannelState;
}
